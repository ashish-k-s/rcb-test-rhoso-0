<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Setup MetalLB L2 Advertisement configuration :: RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</title>
    <link rel="prev" href="configure-metallb-ip-address-pools.html">
    <link rel="next" href="../storage/storage.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rcb-test-rhoso-0" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../introduction/introduction.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/traditional-tripleo-deployment-versus-deployment-with-openshift-cluster.html">Traditional TripleO deployment versus deployment with OpenShift cluster.</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/rhoso-installation-process-overview.html">RHOSO installation process overview</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../prerequisites-for-installation/prerequisites-for-installation.html">Prerequisites for Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../prerequisites-for-installation/about-the-prerequisite-operators.html">About the Prerequisite Operators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../prerequisites-for-installation/install-nmstate-operator.html">Install NMState Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../prerequisites-for-installation/install-metallb-operator.html">Install MetalLB Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../prerequisites-for-installation/install-cert-manager-operator.html">Install Cert-Manager Operator</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="preparing-rhocp-for-rhosp-network-isolation.html">Preparing RHOCP for RHOSP Network Isolation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setting-up-node-network-configuration-policy.html">Setting up Node Network Configuration Policy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuring-network-attachment-definition.html">Configuring Network Attachment Definition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configure-metallb-ip-address-pools.html">Configure MetalLB IP Address Pools</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="setup-metallb-l2-advertisement-configuration.html">Setup MetalLB L2 Advertisement configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../storage/storage.html">Storage</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/configuring-nfs-storage.html">Configuring NFS storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/verify-storage-configuration.html">Verify storage configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../install-control-plane/install-control-plane.html">Install control plane</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install-control-plane/configure-the-secrets.html">Configure the secrets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install-control-plane/install-the-openstack-operator.html">Install the OpenStack Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install-control-plane/create-the-openstack-control-plane.html">Create the OpenStack Control Plane</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install-control-plane/troubleshoot-the-openstack-control-plane.html">Troubleshoot the OpenStack Control Plane</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install-control-plane/verify-openstack-control-plane-configuration.html">Verify OpenStack control plane configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../create-data-plane/create-data-plane.html">Create data plane</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../create-data-plane/create-the-data-plane-network-configuration.html">Create the Data Plane Network configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../create-data-plane/create-the-data-plane-vm.html">Create the Data Plane VM</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../create-data-plane/data-plane-deployment.html">Data Plane Deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../create-data-plane/troubleshoot-the-data-plane-deployment.html">Troubleshoot the Data Plane deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../create-data-plane/verify-data-plane-deployment.html">Verify data plane deployment</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../access-openstack/access-openstack.html">Access OpenStack</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../access-openstack/steps-to-access-openstack.html">Steps to Access OpenStack</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</a></li>
    <li><a href="preparing-rhocp-for-rhosp-network-isolation.html">Preparing RHOCP for RHOSP Network Isolation</a></li>
    <li><a href="setup-metallb-l2-advertisement-configuration.html">Setup MetalLB L2 Advertisement configuration</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Setup MetalLB L2 Advertisement configuration</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>===
## Setup MetalLB L2 Advertisement Configuration</p>
</div>
<div class="paragraph">
<p>MetalLB is a layer 2 load balancer implementation for Kubernetes. In the context of Red Hat OpenShift Container Platform (RHOCP), MetalLB is used to manage the data plane nodes' network configuration for Red Hat OpenStack Platform (RHOSP). To configure MetalLB L2 Advertisement, follow these steps:</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h3>
<div class="paragraph">
<p>Before configuring MetalLB L2 Advertisement, ensure you have completed the following tasks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Installed the NMState Operator, Cert-Manager Operator, and MetalLB Operator in your RHOCP cluster.</p>
</li>
<li>
<p>Configured network settings for node network configuration policies (NNCP).</p>
</li>
<li>
<p>Created a Network Attachment Definition (NAD) for your data plane nodes.</p>
</li>
<li>
<p>Configured IP address pools for MetalLB using the Cert-Manager Operator.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_by_step_configuration"><a class="anchor" href="#_step_by_step_configuration"></a>Step-by-step Configuration</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Apply MetalLB L2 Advertisement configuration</strong></p>
<div class="literalblock">
<div class="content">
<pre>Create a YAML file named `metallb-config.yaml` with the following content:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>```yaml
apiVersion: metallb.io/v1beta1
kind: L2Advertisement
metadata:
  name: metallb-l2-advert-data-plane
  namespace: &lt;your-namespace&gt; # Replace with your desired namespace
spec:
  ipAddressPools:
    - &lt;ip-address-pool-name&gt; # Replace with the name of the IP address pool you configured
  lacpNetworkType: "Layer2"
  lacpActive
  layer2Configuration:
    nodeSelector:
        kubernetes.io/hostname: "&lt;data-plane-node-hostname&gt;" # Replace with your data plane node's hostname
```</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>This configuration specifies which IP address pools to use for L2 advertisement, and identifies the specific data plane node(s) where this configuration should apply.</pre>
</div>
</div>
</li>
<li>
<p><strong>Apply the MetalLB configuration</strong></p>
<div class="literalblock">
<div class="content">
<pre>Apply the YAML file using `kubectl`:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>```bash
kubectl apply -f metallb-config.yaml
```</pre>
</div>
</div>
</li>
<li>
<p><strong>Verify MetalLB L2 Advertisement configuration</strong></p>
<div class="literalblock">
<div class="content">
<pre>After applying the configuration, verify that the MetalLB L2 advertisement is correctly configured:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>```bash
kubectl get l2advertisements -n &lt;your-namespace&gt;
```</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>This command should display your `metallb-l2-advert-data-plane` entry with the appropriate pool and node.</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting"><a class="anchor" href="#_troubleshooting"></a>Troubleshooting</h3>
<div class="paragraph">
<p>If you encounter issues, consider the following common problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Incorrect IP address pools:</strong> Ensure that the <code>ipAddressPools</code> reference matches a valid IP address pool previously configured using Cert-Manager.</p>
</li>
<li>
<p><strong>Node Selector not matching:</strong> Verify that the <code>nodeSelector</code> in your MetalLB L2 Advertisement configuration correctly identifies the desired data plane nodes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For further assistance, consult OpenShift and RHOSP documentation or engage with Red Hat Support for expert insights and troubleshooting guidance.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="configure-metallb-ip-address-pools.html">Configure MetalLB IP Address Pools</a></span>
  <span class="next"><a href="../storage/storage.html">Storage</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
