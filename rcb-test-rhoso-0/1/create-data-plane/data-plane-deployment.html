<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Data Plane Deployment :: RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</title>
    <link rel="prev" href="create-the-data-plane-vm.html">
    <link rel="next" href="troubleshoot-the-data-plane-deployment.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rcb-test-rhoso-0" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../introduction/introduction.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/traditional-tripleo-deployment-versus-deployment-with-openshift-cluster.html">Traditional TripleO deployment versus deployment with OpenShift cluster.</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduction/rhoso-installation-process-overview.html">RHOSO installation process overview</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../prerequisites-for-installation/prerequisites-for-installation.html">Prerequisites for Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../prerequisites-for-installation/about-the-prerequisite-operators.html">About the Prerequisite Operators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../prerequisites-for-installation/install-nmstate-operator.html">Install NMState Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../prerequisites-for-installation/install-metallb-operator.html">Install MetalLB Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../prerequisites-for-installation/install-cert-manager-operator.html">Install Cert-Manager Operator</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../preparing-rhocp-for-rhosp-network-isolation/preparing-rhocp-for-rhosp-network-isolation.html">Preparing RHOCP for RHOSP Network Isolation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../preparing-rhocp-for-rhosp-network-isolation/setting-up-node-network-configuration-policy.html">Setting up Node Network Configuration Policy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../preparing-rhocp-for-rhosp-network-isolation/configuring-network-attachment-definition.html">Configuring Network Attachment Definition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../preparing-rhocp-for-rhosp-network-isolation/configure-metallb-ip-address-pools.html">Configure MetalLB IP Address Pools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../preparing-rhocp-for-rhosp-network-isolation/setup-metallb-l2-advertisement-configuration.html">Setup MetalLB L2 Advertisement configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../storage/storage.html">Storage</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/configuring-nfs-storage.html">Configuring NFS storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/verify-storage-configuration.html">Verify storage configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../install-control-plane/install-control-plane.html">Install control plane</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install-control-plane/configure-the-secrets.html">Configure the secrets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install-control-plane/install-the-openstack-operator.html">Install the OpenStack Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install-control-plane/create-the-openstack-control-plane.html">Create the OpenStack Control Plane</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install-control-plane/troubleshoot-the-openstack-control-plane.html">Troubleshoot the OpenStack Control Plane</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../install-control-plane/verify-openstack-control-plane-configuration.html">Verify OpenStack control plane configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="create-data-plane.html">Create data plane</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="create-the-data-plane-network-configuration.html">Create the Data Plane Network configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="create-the-data-plane-vm.html">Create the Data Plane VM</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="data-plane-deployment.html">Data Plane Deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshoot-the-data-plane-deployment.html">Troubleshoot the Data Plane deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="verify-data-plane-deployment.html">Verify data plane deployment</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../access-openstack/access-openstack.html">Access OpenStack</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../access-openstack/steps-to-access-openstack.html">Steps to Access OpenStack</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes</a></li>
    <li><a href="create-data-plane.html">Create data plane</a></li>
    <li><a href="data-plane-deployment.html">Data Plane Deployment</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Data Plane Deployment</h1>
<h1 id="_data_plane_deployment" class="sect0"><a class="anchor" href="#_data_plane_deployment"></a>Data Plane Deployment</h1>
<div class="paragraph">
<p>In this section, we will cover the steps required to deploy the data plane in a Red Hat OpenShift Container Storage (RHOCP) environment configured for Red Hat OpenStack Platform (RHOSP). The data plane consists of Virtual Machines (VMs) that handle the actual data storage and processing.</p>
</div>
<div class="sect1">
<h2 id="_create_the_data_plane_network_configuration"><a class="anchor" href="#_create_the_data_plane_network_configuration"></a>Create the Data Plane Network Configuration</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Create a custom network attachment definition (NAD):</strong></p>
<div class="literalblock">
<div class="content">
<pre>Use the following AsciiDoc code block as a template to create a NetworkAttachmentDefinition resource YAML file, e.g., `dataplane-nad.yaml`.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>```yaml
---
apiVersion: "k8s.cni.cncf.io/v1"
kind: NetworkAttachmentDefinition
metadata:
  name: openstack-dataplane
spec:
  config: |
    {
      "cniVersion": "0.3.0",
      "name": "openstack-dataplane",
      "type": "host-device",
      "ipam": {},
      "mount": {
        "noWrap": true,
        "device": "/sys/class/net"
      }
    }
```</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Apply the configuration using `kubectl apply -f dataplane-nad.yaml`.</pre>
</div>
</div>
</li>
<li>
<p><strong>Create a custom node network configuration policy (NNCP):</strong></p>
<div class="literalblock">
<div class="content">
<pre>Using the following AsciiDoc code block as a template, create a NodeNetworkConfigurationPolicy resource YAML file, e.g., `dataplane-nncp.yaml`.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>```yaml
---
apiVersion: "policy.open-cluster-management.io/v1"
kind: NodeNetworkConfigurationPolicy
metadata:
  name: openstack-dataplane-nncp
  namespace: &lt;desired-namespace&gt;
spec:
  nodeSelector:
    matchExpressions:
      - key: node-role.kubernetes.io/dataplane
        operator: In
  desiredLinkState: "present"
  links:
    - name: ens3 # or the appropriate interface name for your environment
      state: "up"
```</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Apply the configuration using `kubectl apply -f dataplane-nncp.yaml`.</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_the_data_plane_vm"><a class="anchor" href="#_create_the_data_plane_vm"></a>Create the Data Plane VM</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Create a custom machineset:</strong></p>
<div class="literalblock">
<div class="content">
<pre>Using the following AsciiDoc code block as a template, create a MachineSet resource YAML file, e.g., `dataplane-machineset.yaml`.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>```yaml
---
apiVersion: "machine.openshift.io/v1beta1"
kind: MachineSet
metadata:
  name: openstack-dataplane
spec:
  replicas: 3 # Adjust the number of VMs as needed
  selector:
    matchLabels:
      machine.open-cluster-management.io/generated-by: openshift-machine-api
  template:
    metadata:
      labels:
        machine.open-cluster-management.io/generated-by: openshift-machine-api
    spec:
      taints:
        - key: node-role.kubernetes.io/dataplane
          effect: NoSchedule
      providerSpec:
        value:
          ... # Configure your cloud provider specifics here, e.g., OpenStack
        resources:
          requests:
            memory: "4Gi"
            ephemeral-storage: "16Gi"
```</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Apply the configuration using `kubectl apply -f dataplane-machineset.yaml`.</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_plane_deployment_2"><a class="anchor" href="#_data_plane_deployment_2"></a>Data Plane Deployment</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Monitor deployment progress:</strong></p>
<div class="literalblock">
<div class="content">
<pre>Observe the status of your MachineSet and the created VMs with the following command:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>```bash
watch kubectl get machines --show-labels --sort-by=.metadata.name
```</pre>
</div>
</div>
</li>
<li>
<p><strong>Verify data plane deployment:</strong></p>
<div class="literalblock">
<div class="content">
<pre>Once all the desired VMs are running, you can proceed to deploy OpenStack services on them using Helm charts or other appropriate methods provided by RHOSP documentation.</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshoot_data_plane_deployment"><a class="anchor" href="#_troubleshoot_data_plane_deployment"></a>Troubleshoot Data Plane Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you encounter issues during the data plane VM creation or deployment, consider these troubleshooting steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Check Node Network Configuration Policy (NNCP) status:</strong></p>
<div class="literalblock">
<div class="content">
<pre>Use `kubectl get nncp openstack-dataplane-nncp -n &lt;desired-namespace&gt;` to verify if NNCP is applied successfully.</pre>
</div>
</div>
</li>
<li>
<p><strong>Inspect MachineSet events:</strong></p>
<div class="literalblock">
<div class="content">
<pre>Run `kubectl describe machineset openstack-dataplane` to check for any errors or issues related to the MachineSet.</pre>
</div>
</div>
</li>
<li>
<p><strong>Review cloud provider logs:</strong></p>
<div class="literalblock">
<div class="content">
<pre>Check your OpenStack environment's logs for any relevant information about VM provisioning failures, such as authentication errors, resource quota issues, or network configuration problems.</pre>
</div>
</div>
</li>
<li>
<p><strong>Consult RHOCP and OpenStack documentation:</strong></p>
<div class="literalblock">
<div class="content">
<pre>Refer to official documentation for detailed troubleshooting guidance on specific error messages or scenarios you might encounter.</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_verify_data_plane_deployment"><a class="anchor" href="#_verify_data_plane_deployment"></a>Verify Data Plane Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After successfully deploying the data plane VMs, ensure they are functioning as expected by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Checking VM status:</strong> Use <code>kubectl get pods -n &lt;desired-namespace&gt;</code> to verify if OpenStack service pods are running on the created VMs.</p>
</li>
<li>
<p><strong>Testing network connectivity:</strong> Perform network tests between VMs and other components within your RHOSP environment, ensuring proper isolation and communication as configured.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By following these steps, you will have successfully deployed the data plane in your RHOCP environment configured for RHOSP. Remember to adapt and modify configurations based on your specific environment and requirements.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="create-the-data-plane-vm.html">Create the Data Plane VM</a></span>
  <span class="next"><a href="troubleshoot-the-data-plane-deployment.html">Troubleshoot the Data Plane deployment</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
