#  Configuring Network Attachment Definition

= RHOSP18 - Provision Control Plane Services and Manage Data Plane Nodes
== Preparing RHOCP for RHOSP Network Isolation

...

= Configuring Network Attachment Definition

In Red Hat OpenShift (RHOCP), the Network Attachment Definition (NAD) is a custom resource that allows you to define and request additional network interfaces on your nodes. These additional interfaces can be used for various purposes, such as connecting to external networks or implementing advanced networking configurations like VLANs or bonding.

For Red Hat OpenShift Container Platform (RHOCP) preparation in a Red Hat OpenStack Platform (RHOSP) environment with network isolation, you need to configure the Network Attachment Definitions properly before proceeding with control plane and data plane services installation. Hereâ€™s a step-by-step guide on how to accomplish this:

1. **Create a YAML file for Network Attachment Definition:**

   Begin by creating a YAML file that defines your desired network interface configuration. This file will request additional interfaces (also called "secondary" or "subinterfaces") on your RHOCP worker nodes when they are deployed on RHOSP. An example NAD YAML configuration for a VLAN interface could look like this:

   ```yaml
   apiVersion: "k8s.cni.cncf.io/v1"
   kind: NetworkAttachmentDefinition
   metadata:
     name: my-vlan-nad
   spec:
     config: |
       {
         "cniVersion": "0.3.1",
         "name": "my-vlan-net",
         "type": "vlan",
         "vlanId": 100,
         "ipam": {
           "type": "host-local",
           "subnet": "192.168.1.0/24"
         }
       }
   ```

   In this example, a VLAN interface with ID 100 is created on each worker node, using the subnet `192.168.1.0/24`.

2. **Apply the Network Attachment Definition:**

   Use `kubectl` to apply your YAML configuration to RHOCP:

   ```bash
   kubectl apply -f my-vlan-nad.yaml
   ```

   This command will create the specified Network Attachment Definition in your RHOCP cluster.

3. **Verify the Network Attachment Definition:**

   To ensure that the NAD was successfully created, you can list all NetworkAttachmentDefinitions using:

   ```bash
   kubectl get networkattachmentdefinitions
   ```

   You should see your newly created "my-vlan-nad" listed among other default or existing NADs.

4. **Configure Node Network Configuration Policy:**

   With the Network Attachment Definition in place, proceed to configure the Node Network Configuration Policy (NNCP). This policy ensures that when RHOCP nodes are created on your RHOSP infrastructure, they will have the desired additional network interfaces based on the NAD you defined earlier.

By following these steps, you ensure that RHOCP nodes deployed on RHOSP not only receive the primary management and service interfaces but also the additional interfaces specified in the Network Attachment Definition, facilitating proper network isolation and enhanced connectivity options for your OpenStack control plane and data plane services.